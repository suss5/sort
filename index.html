<html>
<body>
  <label for="algorithm">Algorithm:</label>
  <select id="algorithm">
    <option value="Bubble">Bubble</option>
    <option value="Merge">Merge</option>
  </select> 
  <br> <br>
 <button id="generate" onclick="gen()">Generate</button>
 <button id="sort" onclick="mySort()">Sort</button>
 <canvas id="Canvas1" width="900" height="500"></canvas>
<br>
<p>SortDemo</p>  

<script>
var c1 = document.getElementById("Canvas1");
var ct1 = c1.getContext("2d");
var choiceAlg=document.getElementById('algorithm')
var size=10
var arr=[], pos=[], boxWidth=40
var sorting=false,anim=0
var p=0,sorted,steps
 
function gen(){
  for(i=0;i<size;i++){
    arr[i]=Math.floor(Math.random()*10)
    pos[i]=boxWidth*i
  }
  console.log("startpos="+pos)
  display()
}
 
function display(){
  ct1.font="18px Monospace"
  ct1.clearRect(0,0,900,500)
  ct1.fillStyle="black"
  for(i=0;i<size;i++){
    ct1.fillText(arr[i],pos[i],100)
    ct1.fillRect(pos[i],120,.5*boxWidth,10*arr[i])
  }
}
  
function mySort(){
  if(sorting==true){ return }
  if(choiceAlg.value=="Bubble"){ sorting=true; sorted=false; steps=0; bubbleSort() }
  else{ alert("MergeSort Not implemented yet") }
}
  
function bubbleSort(){  
  p=0
  sorted=true
  bubble()
  if(sorted==true){
  ct1.fillStyle="red"
  ct1.fillText("Sorted steps="+steps,10,250)
  sorting=false}
  else{alert("next cycle");bubbleSort() }
}
  
function bubble(){
  steps++
  if(arr[p+1]<arr[p]){ sorted=false; anim=0; swap(p,p+1)}
  display()
  p++
  if(p<size-1){bubble() }
 }
  
function swap(a,b){
  anim+=5
  if(anim<boxWidth){
    pos[a]+=5
    pos[b]-=5
    console.log("swap pos="+pos)
    ct1.fillStyle="red"
    ct1.fillRect(pos[a],120,.5*boxWidth,10*arr[a])
    ct1.fillStyle="blue"
    ct1.fillRect(pos[b],120,.5*boxWidth,10*arr[b])
    sleep(500)
    requestAnimationFrame(function(){swap(a,b)} )
  }
  else{
  pos[a]-=boxWidth
  pos[b]+=boxWidth
  temp=arr[a]
  arr[a]=arr[b]
  arr[b]=temp
  console.log("fini pos="+pos)
  }
}
  
function sleep(ms) {
  const start = new Date().getTime();
  let currentTime = start;

  while (currentTime - start < ms) {
    currentTime = new Date().getTime();
  }
}


</script>
</body>
</html>
